<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <!-- appelle le template layoutbis.xhtml -->
    <ui:composition template="newTemplate.xhtml"> 
        <!-- Defini la partie nommée contenu dans le template par le bloc qui suit -->
        <ui:define name="content"> 
            <h:form id="form"> 
            <h2>Projets</h2>
            
<p:tabView id="tabView">  
    <p:tab id="tab00" title="Liste des projets en cours">  
        <h:panelGrid columns="2" cellpadding="10">
                    <h:form>  
                        <p:dataTable id="tableProjetEnCours" var="projet" value="#{projetM.getProjet(true)}" sortMode="multiple" rows="5" paginator="true">  
                            <f:facet name="header">  
                                Projets  
                            </f:facet>  
                            
                            <p:column headerText="Progression" width="25px" >
                                <p:progressBar value="#{projet.progression}" labelTemplate="{value}%" displayOnly="true" style="width:80px"/>
                            </p:column>

                            <p:column sortBy="nomProjet" headerText="Nom du projet">  
                                <h:outputText value="#{projet.nomProjet}" />  
                            </p:column>  

                            <p:column sortBy="societe" headerText="Societe">  
                                <h:outputText value="#{projet.client.societe}" />  
                            </p:column> 
                            
                            <p:column sortBy="nomClient" headerText="Nom du client">  
                                <h:outputText value="#{projet.client.nom}" />  
                            </p:column>  
                            
                            <p:column sortBy="nomChef" headerText="Nom du CdP">  
                                <h:outputText value="#{projet.chefDeProjet.nom}" />  
                            </p:column>  
                            
                            <p:column sortBy="nomComm" headerText="Nom du commercial">  
                                <h:outputText value="#{projet.commercial.nom}" />  
                            </p:column> 

                            <p:growl id="growl" showDetail="true" />
                            
                            <p:column headerText=" " >
                                <p:commandLink 
                                    process="@this"
                                    partialSubmit="true"
                                    oncomplete="fiche.show()" 
                                    update=":form" >
                                    <img src="fiche.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener target="#{projet}"  value="#{projet}"/> 
                                </p:commandLink>
                                <p:commandLink process="@this" oncomplete="down.show()" update=":form" >
                                    <img src="download.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener value="#{projet}" target="#{projetM.selectedProjet}"/> 
                                </p:commandLink>
                                <p:commandLink process="@this" oncomplete="dlgclt3.show()" update=":form" >
                                    <img src="upload.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener target="#{updateClient.selectedDoc}"  value="#{clt}"/> 
                                </p:commandLink>
                            </p:column>
                            
                        </p:dataTable>
                        
                        <p:dialog id="dialog"  header="Documents du projet #{projetM.selectedProjet.nomProjet}" width="1000px"
                                  widgetVar="down" resizable="false"
                                  showEffect="bounce"
                                  hideEffect="explode">
                            <p:dataTable id="tableProjetEnCours5" var="documents" value="#{projetM.selectedProjet.getDocuments()}" sortMode="multiple" rows="5" paginator="true">  
        
                                <p:column sortBy="nomProjet" headerText="Documents">  
                                    <h:outputText value="#{documents.nomDoc}" />  
                                </p:column>
                            </p:dataTable>
                            <p:ring id="basic" value="#{projetM.selectedProjet.getDocuments()}" var="documents">
                                <p:outputPanel style="text-align:center;" layout="block">
                                        #{documents.nomDoc}
                                    <p:commandButton icon="ui-icon-disk" title="Télécharger">
                                    </p:commandButton>
                                </p:outputPanel>
                            </p:ring>
                        </p:dialog>

                        <p:dialog id="dialog0"  header="Documents du projet" 
                                  widgetVar="dlgclt3" resizable="false"  
                                  modal="true"
                                  showEffect="bounce"
                                  hideEffect="explode">
                        </p:dialog>

                        <p:dialog id="dialog2"  header="Projet #{Projet.nomProjet}" 
                                  widgetVar="fiche" resizable="false"  
                                  modal="true"
                                  showEffect="bounce"
                                  hideEffect="explode">
                        </p:dialog>
                    </h:form>
        </h:panelGrid>  
    </p:tab>  
                
    

//-------------------------------------------------------------------------------------------------
    <p:tab id="tab01" title="Liste des projets terminés">  
        <h:panelGrid columns="2" cellpadding="10">
            <h:form>  
                <p:dataTable id="tableProjetFinit" var="projet" value="#{projetM.getProjet(false)}" sortMode="multiple" rows="5" paginator="true">  
                            <f:facet name="header">  
                                Projets  
                            </f:facet>  
                            
                            <p:column headerText="Progression" width="25px" >
                                <p:progressBar value="#{projet.progression}" labelTemplate="{value}%" displayOnly="true" style="width:80px"/>
                            </p:column>

                            <p:column sortBy="nomProjet" headerText="Nom du projet">  
                                <h:outputText value="#{projet.nomProjet}" />  
                            </p:column>  

                            <p:column sortBy="societe" headerText="Societe">  
                                <h:outputText value="#{projet.client.societe}" />  
                            </p:column> 
                            
                            <p:column sortBy="nomClient" headerText="Nom du client">  
                                <h:outputText value="#{projet.client.nom}" />  
                            </p:column>  
                            
                            <p:column sortBy="nomChef" headerText="Nom du CdP">  
                                <h:outputText value="#{projet.chefDeProjet.nom}" />  
                            </p:column>  
                            
                            <p:column sortBy="nomComm" headerText="Nom du commercial">  
                                <h:outputText value="#{projet.commercial.nom}" />  
                            </p:column> 

                            
                            
                            <p:column headerText=" " >
                                <p:commandLink 
                                    process="@this"
                                    partialSubmit="true"
                                    oncomplete="fiche.show()" 
                                    update=":form" >
                                    <img src="fiche.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener target="#{projet}"  value="#{projet}"/> 
                                </p:commandLink>
                                <p:commandLink process="@this" oncomplete="down.show()" update=":form" >
                                    <img src="download.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener value="#{projet}" target="#{ProjetDialog.selectedProjet}"/> 
                                </p:commandLink>
                                <p:commandLink process="@this" oncomplete="dlgclt3.show()" update=":form" >
                                    <img src="upload.png" width="24px" height="24px" />
                                    <f:setPropertyActionListener target="#{updateClient.selectedDoc}"  value="#{clt}"/> 
                                </p:commandLink>
                            </p:column>
                            
                        </p:dataTable>
                        
                    </h:form>
        </h:panelGrid>  
    </p:tab>  

//-------------------------------------------------------------------------------------------------

  
    <p:tab id="tab1" title="Ajout d'un projet">  
        <h:panelGrid columns="2" cellpadding="10">
               <h:form>  
                            
                <p:panel header="Nouveau projet">  
                    <h:panelGrid columns="1" style="margin-bottom:10px" cellpadding="5"> 

                        <h:outputText value="Nom du client: *" />
                        <p:selectOneListbox id="scroll" value="#{clientM.selectedClient}"  var="c" style="height:200px">  
                            <f:selectItems value="#{clientM.getOldClient()}" var="client" itemLabel="#{client.societe}" itemValue="#{client}" />  

                            <p:column width="50">  
                                  #{c.societe} ( #{c.siren} )
                            </p:column>  

                            <p:column width="50">  
                                #{c.prenom} #{c.nom} ( #{c.qualite} )
                            </p:column>  
                        </p:selectOneListbox>  

                        <h:outputText value="Nom du projet: *" />                                      
                        <h:inputText id="nom" value="#{etudiant.nom}" >                                   
                            <f:ajax event="blur" render="nomMessage" />                                   
                        </h:inputText>                                   
                        <h:message id="nomMessage" for="nom" errorClass="erreur" />
                              
                    </h:panelGrid>  
                            
                </p:panel>  

                <!-- Envoie le formulaire -->       
                <p:commandButton value="Enregistrer" action="#{projetM.saveProjet}"/>  
                       
            </h:form>  
        </h:panelGrid>  
    </p:tab>  

//-------------------------------------------------------------------------------------------------
	
    <p:tab id="tab2" title="Modification d'un projet">  
        <h:panelGrid columns="2" cellpadding="10">  
					
        </h:panelGrid>  
    </p:tab>  
 
//-------------------------------------------------------------------------------------------------
 
    <p:tab id="tab3" title="Clôture d'un projet">  
        <h:panelGrid columns="2" cellpadding="10">  
			
        </h:panelGrid>  
    </p:tab>  
   
</p:tabView>  
</h:form>
            <!-- Fin du bloc "contenu" -->
        </ui:define> 
        <!-- Fin du template "layout" -->
    </ui:composition> 
</html>
